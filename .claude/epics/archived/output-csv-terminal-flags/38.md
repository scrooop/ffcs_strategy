---
name: Implement Hierarchical Logging System
status: completed
created: 2025-10-20T17:48:36Z
updated: 2025-10-20T19:33:00Z
completed: 2025-10-20T19:33:00Z
github: https://github.com/scrooop/ffcs_strategy/issues/38
depends_on: []
parallel: false
conflicts_with: [39, 40]
commit: da85086
---

# Task: Implement Hierarchical Logging System

## Description

Replace mixed logging formats with unified Python logging system using named sub-loggers. Create custom `SymbolFormatter` for clean `[SYMBOL] STATUS: details` output format. Suppress yfinance logger to eliminate verbose HTTP 404 errors.

**Priority:** MEDIUM (Phase 4 - Terminal Output & Logging)

**Current Problem:**
```
2025-10-20 02:45:43,720 - __main__ - WARNING - ABT 30DTE: Greeks IV missing
2025-10-20 02:36:23,117 - yfinance - ERROR - HTTP Error 404: {"quoteSummary"...}
[INFO] JEPI: No earnings data available
[FILTERED] FUL: Liquidity rating 2 < 3
```

**Desired Output:**
```
[SPY   ] PASS: FF=0.285 (30-60 DTE, strike=450.0, double)
[QQQ   ] FILTER: earnings_conflict (2025-11-15)
[AAPL  ] FILTER: volume_too_low (3.2k < 10k)
```

## Acceptance Criteria

- [ ] `setup_logging()` function created with mode parameter (quiet/normal/verbose/debug)
- [ ] Logger hierarchy established: `scanner`, `scanner.earnings`, `scanner.market_data`, `scanner.greeks`, `scanner.quality`
- [ ] `SymbolFormatter` class implemented for `[SYMBOL] STATUS: details` format
- [ ] yfinance logger suppressed at WARNING level (ERROR still shown)
- [ ] Console handler uses custom formatter (except debug mode)
- [ ] All existing `print()` statements replaced with `logger.*()` calls
- [ ] Logger levels set correctly per mode

## Technical Details

### Files to Modify
- `scripts/ff_tastytrade_scanner.py`:
  - Add `setup_logging()` function (after imports, before helpers)
  - Add `SymbolFormatter` class (after setup_logging)
  - Update main() to call setup_logging() (around line 1780)
  - Replace all print() with logger calls throughout

### Implementation Approach

**1. Setup Logging Function:**
```python
def setup_logging(mode: str) -> logging.Logger:
    """
    Configure hierarchical logging system.

    Args:
        mode: "quiet", "normal", "verbose", or "debug"

    Returns:
        Root scanner logger
    """
    # Create root scanner logger
    scanner_logger = logging.getLogger("scanner")
    scanner_logger.handlers = []  # Clear existing handlers

    # Set level based on mode
    if mode == "quiet":
        scanner_logger.setLevel(logging.ERROR)
    elif mode == "debug":
        scanner_logger.setLevel(logging.DEBUG)
    else:  # normal, verbose
        scanner_logger.setLevel(logging.INFO)

    # Console handler
    console = logging.StreamHandler()
    if mode == "debug":
        # Debug mode: timestamps and logger names
        fmt = logging.Formatter('%(asctime)s - %(name)s - %(levelname)s - %(message)s')
    else:
        # Normal/verbose/quiet: custom symbol formatter
        fmt = SymbolFormatter()
    console.setFormatter(fmt)
    scanner_logger.addHandler(console)

    # Suppress yfinance logger (only show ERROR+)
    logging.getLogger("yfinance").setLevel(logging.ERROR)

    return scanner_logger
```

**2. Custom SymbolFormatter:**
```python
class SymbolFormatter(logging.Formatter):
    """Format log messages as [SYMBOL] STATUS: details"""

    def format(self, record):
        # Extract symbol from message (assume format: "SYMBOL: message")
        msg = str(record.msg)
        if ':' in msg:
            parts = msg.split(':', 1)
            symbol = parts[0].strip()
            message = parts[1].strip()

            # Map log level to status keyword
            status_map = {
                'DEBUG': 'DEBUG',
                'INFO': 'INFO',
                'WARNING': 'WARN',
                'ERROR': 'ERROR'
            }
            status = status_map.get(record.levelname, record.levelname[:5].upper())

            # Format: [SYMBOL] STATUS: message
            return f"[{symbol:6}] {status:5}: {message}"
        else:
            # No symbol prefix, return as-is
            return msg
```

**3. Update main() to Initialize Logging:**
```python
def main():
    parser = argparse.ArgumentParser(...)
    # ... existing arg parsing ...
    args = parser.parse_args()

    # Setup logging (NEW)
    if args.debug:
        mode = "debug"
    elif args.quiet:
        mode = "quiet"
    elif args.verbose:
        mode = "verbose"
    else:
        mode = "normal"

    logger = setup_logging(mode)
    # ... rest of main ...
```

**4. Get Named Sub-Loggers:**
```python
# In scan() or other functions:
earnings_logger = logging.getLogger("scanner.earnings")
market_logger = logging.getLogger("scanner.market_data")
greeks_logger = logging.getLogger("scanner.greeks")
quality_logger = logging.getLogger("scanner.quality")
```

**5. Replace print() Statements:**
```python
# OLD: print(f"[INFO] {sym}: Earnings conflict")
# NEW: quality_logger.info(f"{sym}: Earnings conflict")

# OLD: print(f"[FILTERED] {sym}: Volume too low")
# NEW: quality_logger.warning(f"{sym}: Volume too low")
```

### Key Considerations
- Use lazy string formatting: `logger.info("%s: %s", symbol, message)` not `logger.info(f"{symbol}: {message}")`
- Preserve existing log levels (INFO, WARNING, ERROR)
- Don't log symbol prefixes in debug mode (timestamps are more important)
- Scanner hierarchy allows filtering by component (e.g., only show earnings logs)

## Dependencies

**External:**
- [ ] Python `logging` module (built-in, no install needed)

**Internal:**
- [ ] Conflicts with Task #39 (output modes) - must coordinate logger levels
- [ ] Conflicts with Task #40 (file logging) - must add FileHandler to same logger

## Effort Estimate

- **Size:** M (Medium)
- **Hours:** 6-8 hours
- **Parallel:** false (conflicts with tasks 39, 40 - same code sections)

### Breakdown:
- Create setup_logging() and SymbolFormatter: 2 hours
- Replace all print() statements: 3-4 hours
- Test logging output: 1-2 hours

## Definition of Done

- [ ] `setup_logging()` function implemented and called from main()
- [ ] `SymbolFormatter` class implemented with symbol padding logic
- [ ] Logger hierarchy created (scanner, scanner.earnings, etc.)
- [ ] All print() statements replaced with logger.*() calls
- [ ] yfinance logger suppressed at WARNING level
- [ ] Console output shows `[SYMBOL] STATUS: details` format (normal mode)
- [ ] Debug mode shows timestamps and logger names
- [ ] No mixed logging formats in output
