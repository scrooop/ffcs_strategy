---
name: Add Edge Case Validation & Unit Tests
status: completed
created: 2025-10-19T23:37:22Z
updated: 2025-10-20T05:15:00Z
completed: 2025-10-20T05:15:00Z
github: https://github.com/scrooop/ffcs_strategy/issues/23
depends_on: []
parallel: false
conflicts_with: []
---

# Task 001: Add Edge Case Validation & Unit Tests

## Description

Implement validation function for forward variance calculations and comprehensive unit tests for all FF formulas. This establishes the safety net before any FF logic changes.

## Acceptance Criteria

- [x] Create `validate_ff_inputs()` function that checks for non-positive forward variance
- [x] Function returns `skip_reason` string if invalid, None if valid
- [x] Add unit tests for forward variance calculation: V_fwd = (IV_back^2 * T2 - IV_front^2 * T1) / (T2 - T1)
- [x] Add unit tests for forward IV calculation: IV_fwd = sqrt(V_fwd)
- [x] Add unit tests for FF formula: FF = (IV_front - IV_fwd) / IV_fwd
- [x] Test edge cases: negative variance (IV_back^2 * T2 <= IV_front^2 * T1), zero DTE, invalid IVs
- [x] All tests use double-precision float (64-bit) with 1e-8 tolerance for comparisons
- [x] Test monotonicity: FF increases as IV_front increases (holding other vars constant)

## Technical Details

- **File:** scripts/ff_tastytrade_scanner.py
- Add new function before existing calculation functions
- Formula validation using reference test cases
- Use Python's math module for sqrt, precision checks

## Dependencies

- None (foundation task)

## Effort Estimate

- **Size:** S
- **Hours:** 4-6
- **Parallel:** false (must complete before other changes)

## Definition of Done

- [x] `validate_ff_inputs()` function implemented
- [x] Unit tests written with ≥95% formula coverage
- [x] All tests passing (30/30)
- [x] Tests documented with reference values
- [x] Code reviewed

## Completion Summary

**Completed:** 2025-10-20 05:15 UTC
**Test Results:** 30/30 passing (100%)
**Coverage:** ≥95% (exceeds requirement)

**Deliverables:**
- `validate_ff_inputs()` function (67 lines in scripts/ff_tastytrade_scanner.py)
- Comprehensive unit test suite (571 lines in tests/test_ff_calculations.py)
- 30 tests covering all formulas and edge cases
- Reference values documented with calculations

**Commits:**
- 1d30104: Add validate_ff_inputs() function
- 90b52d7: Add comprehensive unit test suite for FF formulas

**Documentation:**
- `.claude/epics/core-calc-corrections/updates/23/progress.md`
- `.claude/epics/core-calc-corrections/updates/23/COMPLETE.md`
