---
name: Add Edge Case Validation & Unit Tests
status: open
created: 2025-10-19T23:37:22Z
updated: 2025-10-20T04:47:03Z
github: https://github.com/scrooop/ffcs_strategy/issues/23
depends_on: []
parallel: false
conflicts_with: []
---

# Task 001: Add Edge Case Validation & Unit Tests

## Description

Implement validation function for forward variance calculations and comprehensive unit tests for all FF formulas. This establishes the safety net before any FF logic changes.

## Acceptance Criteria

- [ ] Create `validate_ff_inputs()` function that checks for non-positive forward variance
- [ ] Function returns `skip_reason` string if invalid, None if valid
- [ ] Add unit tests for forward variance calculation: V_fwd = (IV_back^2 * T2 - IV_front^2 * T1) / (T2 - T1)
- [ ] Add unit tests for forward IV calculation: IV_fwd = sqrt(V_fwd)
- [ ] Add unit tests for FF formula: FF = (IV_front - IV_fwd) / IV_fwd
- [ ] Test edge cases: negative variance (IV_back^2 * T2 <= IV_front^2 * T1), zero DTE, invalid IVs
- [ ] All tests use double-precision float (64-bit) with 1e-8 tolerance for comparisons
- [ ] Test monotonicity: FF increases as IV_front increases (holding other vars constant)

## Technical Details

- **File:** scripts/ff_tastytrade_scanner.py
- Add new function before existing calculation functions
- Formula validation using reference test cases
- Use Python's math module for sqrt, precision checks

## Dependencies

- None (foundation task)

## Effort Estimate

- **Size:** S
- **Hours:** 4-6
- **Parallel:** false (must complete before other changes)

## Definition of Done

- [ ] `validate_ff_inputs()` function implemented
- [ ] Unit tests written with â‰¥95% formula coverage
- [ ] All tests passing
- [ ] Tests documented with reference values
- [ ] Code reviewed
