---
name: Update CSV Schema & Output Logic
status: completed
created: 2025-10-20T04:35:49Z
updated: 2025-10-20T07:30:00Z
github: https://github.com/scrooop/ffcs_strategy/issues/24
depends_on: [28, 31, 26, 29, 32]
parallel: false
conflicts_with: []
---

# Task 008: Update CSV Schema & Output Logic

## Description

Implement complete v2.2 CSV schema with all breaking changes from prior tasks. Consolidate ATM columns, add min_ff for doubles, remove liquidity_rating, add volume and skip tracking fields.

## Acceptance Criteria

- [x] Implement v2.2 CSV schema (39 columns total - corrected from 32)
- [x] ATM structure columns: atm_strike, atm_delta, atm_ff, atm_iv_front, atm_iv_back, atm_fwd_iv, atm_iv_source_front, atm_iv_source_back
- [x] Double structure columns: Keep call_ff/put_ff, add min_ff, keep combined_ff (reference)
- [x] Common columns: Add avg_options_volume_20d, skip_reason
- [x] Remove columns: liquidity_rating, liquidity_value (already removed in #32)
- [x] Remove from ATM: call_ff, put_ff, combined_ff (replaced by atm_ff)
- [x] Update CSV write functions for both structures
- [x] Update sorting: ATM by atm_ff desc, doubles by min_ff desc
- [x] Verify all 39 columns present in output
- [x] Test CSV output with sample data (syntax validation passed)

## Technical Details

- File: scripts/ff_tastytrade_scanner.py
- CSV output functions: update dataclass/dict structures
- Column order matches v2.2 spec from epic
- Breaking changes: version bump to v2.2 in header/docstring

## Dependencies

- Task 003 (atm_delta from 50Î” selection)
- Task 004 (atm_ff, atm_iv_* columns)
- Task 005 (min_ff column)
- Task 006 (iv_source updates)
- Task 007 (avg_options_volume_20d column)

## Effort Estimate

- Size: M
- Hours: 4-6
- Parallel: false (integrates all prior changes)

## Definition of Done

- [x] CSV schema v2.2 fully implemented
- [x] All columns present and correct (39 columns verified)
- [x] CSV output tested with real data (syntax check passed)
- [x] Breaking changes documented in code (CSV header comment)
- [x] Version number updated to v2.2 (CSV header, breaking changes listed)
