---
name: Update Double Calendar Gating (Min-Gate)
status: open
created: 2025-10-20T04:35:49Z
updated: 2025-10-20T04:47:03Z
github: https://github.com/scrooop/ffcs_strategy/issues/26
depends_on: [23, 25]
parallel: true
conflicts_with: [24]
---

# Task 005: Update Double Calendar Gating (Min-Gate)

## Description

Change double calendar gating from average(FF_call, FF_put) to min(FF_call, FF_put). Both wings must independently meet threshold. Add min_ff column as primary sorting metric.

## Acceptance Criteria

- [ ] Add `min_ff = min(call_ff, put_ff)` computation for double structure
- [ ] Change gating logic: `min_ff >= threshold` (was `combined_ff >= threshold`)
- [ ] Retain `combined_ff = avg(call_ff, put_ff)` for reference only
- [ ] Update CSV columns: add min_ff, keep combined_ff
- [ ] Update sorting logic: doubles sort by min_ff descending (primary), combined_ff secondary
- [ ] Verify both wings must pass threshold independently
- [ ] Add unit tests for min-gate filtering logic

## Technical Details

- **File:** scripts/ff_tastytrade_scanner.py
- **Scan loop:** Double structure branch (~lines 700-900, estimate)
- **Per-wing FF calculation:** Unchanged (already correct)
- **Gating logic only change:** Formulas untouched

## Dependencies

- Task 001, 002 (validation and skip tracking)
- Independent of Task 003-004 (different structure)

## Effort Estimate

- **Size:** S
- **Hours:** 3-4
- **Parallel:** true (can run with Tasks 006-007)

## Definition of Done

- [ ] min_ff calculation added
- [ ] Gating logic updated to use min_ff
- [ ] CSV columns updated
- [ ] Sorting by min_ff working
- [ ] Unit tests passing
