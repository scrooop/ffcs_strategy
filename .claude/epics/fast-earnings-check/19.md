---
name: Remove --skip-earnings flag (breaking change)
status: open
created: 2025-10-19T23:56:22Z
updated: 2025-10-20T00:07:17Z
github: https://github.com/scrooop/ffcs_strategy/issues/19
depends_on: [16]
parallel: true
conflicts_with: [18]
---

# Task: Remove --skip-earnings flag (breaking change)

## Description

Remove the redundant `--skip-earnings` CLI flag from the scanner. Since earnings filtering is the default behavior, having both `--skip-earnings` and `--allow-earnings` flags is confusing. This is a breaking change that simplifies the CLI interface.

**Key changes:**
- Remove `--skip-earnings` flag from argparse
- Keep `--allow-earnings` flag (disables earnings filtering)
- Update default behavior: earnings filtering enabled by default
- Add helpful error message for users still using `--skip-earnings`

## Acceptance Criteria

- [ ] `--skip-earnings` flag removed from argparse configuration
- [ ] Default behavior: earnings filtering enabled (no flag needed)
- [ ] `--allow-earnings` flag still works (disables earnings filtering)
- [ ] Users running old commands with `--skip-earnings` get clear error message
- [ ] Error message suggests: "Default behavior is to skip earnings. Remove --skip-earnings flag. Use --allow-earnings to disable filtering."
- [ ] `--help` output no longer shows `--skip-earnings` flag
- [ ] `--help` output clearly documents `--allow-earnings` flag

## Technical Details

**File location:** `scripts/ff_tastytrade_scanner.py`

**Current argparse (confusing):**
```python
earnings_group = parser.add_mutually_exclusive_group()
earnings_group.add_argument('--skip-earnings', action='store_true',
                            help='Skip symbols with earnings conflicts (default)')
earnings_group.add_argument('--allow-earnings', action='store_true',
                            help='Allow trading through earnings')
```

**New argparse (simplified):**
```python
parser.add_argument('--allow-earnings', action='store_true',
                    help='Allow trading through earnings (default: filter earnings conflicts)')
```

**Default behavior:**
```python
# Default: filter earnings (unless --allow-earnings flag set)
if not args.allow_earnings:
    # Run earnings pre-filter
    # ...
```

**Migration guide (in error message):**
If user runs: `python ff_tastytrade_scanner.py --skip-earnings ...`

Error output:
```
error: unrecognized arguments: --skip-earnings

MIGRATION NOTE: The --skip-earnings flag has been removed in v2.1.
Earnings filtering is now enabled by default (no flag needed).
  - To filter earnings (default): Remove --skip-earnings flag
  - To allow trading through earnings: Use --allow-earnings flag

Example:
  # OLD (no longer works):
  python ff_tastytrade_scanner.py --tickers SPY --skip-earnings

  # NEW (default behavior, no flag needed):
  python ff_tastytrade_scanner.py --tickers SPY

  # To disable earnings filtering:
  python ff_tastytrade_scanner.py --tickers SPY --allow-earnings
```

**Files affected:**
- `scripts/ff_tastytrade_scanner.py` (argparse configuration)

## Dependencies

- [ ] Task 002 completed (earnings pre-filter integrated, so flag behavior is established)

## Effort Estimate

- **Size:** XS (Extra Small)
- **Hours:** 1-2 hours
- **Parallel:** true (independent CLI change, conflicts with Task 004 on same file)

**Breakdown:**
- Remove argparse flag: 30 minutes
- Update help text: 30 minutes
- Testing: 30 minutes
- Migration note (optional): 30 minutes

## Definition of Done

- [ ] Code updated (argparse flag removed)
- [ ] Manual testing: `--skip-earnings` flag raises error
- [ ] Manual testing: `--allow-earnings` flag still works
- [ ] Manual testing: Default behavior filters earnings correctly
- [ ] `--help` output reviewed (no mention of --skip-earnings)
- [ ] Code reviewed

## Testing Notes

**Manual testing checklist:**
1. Run scanner with no flags: Verify earnings filtering enabled (default)
2. Run scanner with `--allow-earnings`: Verify earnings filtering disabled
3. Run scanner with `--skip-earnings`: Verify clear error message
4. Run `python ff_tastytrade_scanner.py --help`: Verify --skip-earnings not shown

**Command tests:**
```bash
# Should work (default)
python scripts/ff_tastytrade_scanner.py --tickers SPY QQQ --pairs 30-60

# Should work (disable filtering)
python scripts/ff_tastytrade_scanner.py --tickers SPY --pairs 30-60 --allow-earnings

# Should error with migration message
python scripts/ff_tastytrade_scanner.py --tickers SPY --pairs 30-60 --skip-earnings
```

**Help text verification:**
```bash
python scripts/ff_tastytrade_scanner.py --help | grep earnings
# Should show only --allow-earnings, not --skip-earnings
```

## Notes

**Breaking change:** Users with existing scripts using `--skip-earnings` will need to update their commands. The error message should guide them clearly.

**Version note:** This will be part of v2.1 release. Document in changelog/release notes.

**Conflicts with Task 004:** Both tasks modify `ff_tastytrade_scanner.py`. Coordinate to avoid merge conflicts, or complete sequentially.

**Optional enhancement:** Could add a deprecation warning in v2.0.1, then remove in v2.1. For simplicity, this task assumes immediate removal.
