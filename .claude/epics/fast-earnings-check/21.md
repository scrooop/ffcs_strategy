---
name: Performance benchmarking and validation
status: open
created: 2025-10-19T23:56:22Z
updated: 2025-10-20T00:07:28Z
github: https://github.com/scrooop/ffcs_strategy/issues/21
depends_on: [15, 16, 17, 18, 19]
parallel: true
conflicts_with: []
---

# Task: Performance benchmarking and validation

## Description

Conduct comprehensive performance testing to validate that the fast earnings check achieves the PRD's target of 80-95% runtime reduction. Measure cache hit rates, API response times, and end-to-end scan performance with various symbol counts and scenarios.

**Key objectives:**
- Validate PRD performance targets (1000 symbols: 8min → <30s)
- Measure cache hit rates for daily scanning workflows
- Identify performance bottlenecks or regressions
- Create performance report for documentation
- Run integration tests for edge cases

## Acceptance Criteria

- [ ] Performance benchmarks completed for 100, 500, and 1000 symbols
- [ ] Cache hit rate measured for same-day rescans (target: >90%)
- [ ] Cold start performance measured (0% cache hit rate)
- [ ] Warm cache performance measured (90%+ cache hit rate)
- [ ] PRD target validated: 1000 symbols in <30 seconds (heavy earnings week scenario)
- [ ] Backward compatibility confirmed: Same filtering results as v2.0
- [ ] Integration tests pass for edge cases (empty list, all filtered, futures, etc.)
- [ ] Performance report document created with benchmarks and findings

## Technical Details

### Benchmark Scenarios

**Scenario 1: Cold Start (0% cache hit)**
- Input: 1000 symbols (no cache)
- Measure: Total earnings check time
- Target: <30 seconds
- Validates: Yahoo Finance fetching performance

**Scenario 2: Warm Cache (90%+ cache hit)**
- Input: 1000 symbols (900 cached, 100 fresh)
- Measure: Total earnings check time
- Target: <5 seconds
- Validates: Cache lookup performance + incremental Yahoo fetching

**Scenario 3: Heavy Earnings Week**
- Input: 1000 symbols with 80% having earnings conflicts
- Measure: End-to-end scan time (v2.0 vs v2.1)
- Target: 80-95% reduction (8+ min → <30s)
- Validates: PRD performance claim

**Scenario 4: Daily Rescan**
- Input: Same 100 symbols scanned 3x in one day
- Measure: Cache hit rate and time for runs 2-3
- Target: >95% cache hits, <1 second
- Validates: Same-day rescan performance

**Scenario 5: Futures Symbols**
- Input: 10 futures symbols (/ES, /NQ, etc.)
- Measure: Earnings check time
- Target: <100ms (instant, no API calls)
- Validates: Futures bypass logic

### Integration Tests

**Edge Case Tests:**
1. Empty ticker list: Verify no crash
2. All symbols have earnings conflicts: Verify 100% filtered correctly
3. No symbols have earnings conflicts: Verify 0% filtered (all processed)
4. Mixed equities and futures: Verify futures bypass earnings check
5. Invalid symbols: Verify graceful handling (warn, skip)
6. Simulated Yahoo Finance failure: Verify TastyTrade fallback works
7. Simulated cache corruption: Verify auto-rebuild

### Backward Compatibility Test

**Goal:** Verify v2.1 produces same filtering results as v2.0

**Method:**
1. Use same symbol list (100 symbols)
2. Mock Yahoo Finance to return same data as TastyTrade v2.0
3. Compare filtered symbols between v2.0 and v2.1
4. Verify CSV output matches (except timing and earnings_source column)

### Performance Report Template

**Create file:** `.claude/epics/fast-earnings-check/performance-report.md`

```markdown
# Fast Earnings Check - Performance Report

**Date:** 2025-10-19
**Version:** v2.1
**Tester:** [Your Name]

## Executive Summary

[Brief summary of performance improvements]

## Benchmark Results

### Scenario 1: Cold Start (0% cache)
| Symbols | Earnings Check Time | Target | Pass/Fail |
|---------|---------------------|--------|-----------|
| 100     | X.Xs                | <10s   | ✅/❌      |
| 500     | X.Xs                | <20s   | ✅/❌      |
| 1000    | X.Xs                | <30s   | ✅/❌      |

### Scenario 2: Warm Cache (90% hit rate)
| Symbols | Earnings Check Time | Target | Pass/Fail |
|---------|---------------------|--------|-----------|
| 100     | X.Xs                | <1s    | ✅/❌      |
| 500     | X.Xs                | <3s    | ✅/❌      |
| 1000    | X.Xs                | <5s    | ✅/❌      |

### Scenario 3: Heavy Earnings Week (End-to-End)
| Version | 1000 Symbols | Improvement | Target |
|---------|--------------|-------------|--------|
| v2.0    | X min        | -           | -      |
| v2.1    | X sec        | XX%         | 80-95% |

### Scenario 4: Daily Rescan
| Run | Cache Hit Rate | Time  |
|-----|----------------|-------|
| 1   | 0%             | X.Xs  |
| 2   | XX%            | X.Xs  |
| 3   | XX%            | X.Xs  |

### Scenario 5: Futures Symbols
| Symbols | Time  | API Calls Made |
|---------|-------|----------------|
| 10      | X.Xms | 0              |

## Integration Test Results

| Test Case                     | Pass/Fail | Notes |
|-------------------------------|-----------|-------|
| Empty ticker list             | ✅/❌      |       |
| 100% filtered (earnings)      | ✅/❌      |       |
| 0% filtered (no earnings)     | ✅/❌      |       |
| Mixed equities + futures      | ✅/❌      |       |
| Invalid symbols               | ✅/❌      |       |
| Yahoo Finance failure         | ✅/❌      |       |
| Cache corruption              | ✅/❌      |       |

## Backward Compatibility

| Metric                        | v2.0  | v2.1  | Match? |
|-------------------------------|-------|-------|--------|
| Symbols filtered (100 sample) | XX    | XX    | ✅/❌   |
| CSV rows generated            | XX    | XX    | ✅/❌   |
| Filtering logic               | -     | -     | ✅/❌   |

## Findings

[List any performance issues, bottlenecks, or concerns]

## Recommendations

[Any recommendations for further optimization or fixes]

## Conclusion

[Final verdict: Does v2.1 meet PRD performance targets?]
```

**Files affected:**
- None (benchmark scripts are temporary)
- `.claude/epics/fast-earnings-check/performance-report.md` (NEW)

## Dependencies

- [ ] Task 001 completed (EarningsCache module)
- [ ] Task 002 completed (Scanner integration)
- [ ] Task 003 completed (Fallback implementation)
- [ ] Task 004 completed (CSV output)
- [ ] Task 005 completed (CLI flags)

## Effort Estimate

- **Size:** M (Medium)
- **Hours:** 6-8 hours
- **Parallel:** true (can run alongside documentation, no code changes)

**Breakdown:**
- Set up benchmark scripts: 1 hour
- Run cold start benchmarks: 1 hour
- Run warm cache benchmarks: 1 hour
- Run integration tests: 2 hours
- Backward compatibility testing: 1 hour
- Write performance report: 1-2 hours

## Definition of Done

- [ ] All benchmark scenarios completed
- [ ] Performance report document created
- [ ] PRD targets validated (pass/fail for each target)
- [ ] Integration tests pass (all edge cases handled)
- [ ] Backward compatibility confirmed
- [ ] Results reviewed (identify any performance issues)
- [ ] Findings communicated to team

## Testing Notes

### Benchmark Script Template

**Create temporary script:** `scripts/benchmark_earnings.py`

```python
#!/usr/bin/env python3
"""
Benchmark script for fast earnings check performance.
NOT for production use - just for performance validation.
"""

import time
from earnings_cache import EarningsCache

# Test symbols (mix of large caps, mid caps, futures)
SYMBOLS_100 = ['SPY', 'QQQ', 'AAPL', ...]  # 100 symbols
SYMBOLS_500 = SYMBOLS_100 + [...]          # 500 symbols
SYMBOLS_1000 = SYMBOLS_500 + [...]         # 1000 symbols

def benchmark_cold_start(symbols):
    """Benchmark with empty cache."""
    # Clear cache
    import os
    if os.path.exists('.cache/earnings.db'):
        os.remove('.cache/earnings.db')

    cache = EarningsCache()
    start = time.time()
    results = cache.batch_get_earnings(symbols)
    elapsed = time.time() - start
    return elapsed, results

def benchmark_warm_cache(symbols):
    """Benchmark with pre-warmed cache."""
    cache = EarningsCache()
    # First run to warm cache
    cache.batch_get_earnings(symbols)
    # Second run (should hit cache)
    start = time.time()
    results = cache.batch_get_earnings(symbols)
    elapsed = time.time() - start
    return elapsed, results

if __name__ == '__main__':
    print("Running performance benchmarks...")
    # ... run scenarios ...
```

### Integration Test Checklist

```python
# Test 1: Empty list
cache = EarningsCache()
results = cache.batch_get_earnings([])
assert results == {}

# Test 2: Futures symbols
results = cache.batch_get_earnings(['/ES', '/NQ', '/GC'])
for symbol, data in results.items():
    assert data['next_earnings'] is None  # Futures have no earnings

# Test 3: Invalid symbol
results = cache.batch_get_earnings(['INVALID_SYMBOL_XYZ'])
# Should not crash, should return gracefully

# ... more tests ...
```

## Notes

**Don't over-optimize:** If benchmarks show 70% improvement instead of 80%, that's still excellent. Don't spend days micro-optimizing for marginal gains.

**Document failures:** If any targets are missed, document WHY and propose solutions. E.g., "Yahoo Finance slower than expected (200ms avg instead of 100ms) due to network latency."

**Real-world testing:** Test during market hours with live APIs (not just mocks) to get realistic performance data.

**Heavy earnings week simulation:** Use symbol lists from actual heavy earnings weeks (e.g., late October, late January) for realistic testing.
