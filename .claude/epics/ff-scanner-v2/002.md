---
name: Enhanced Greeks Collection
status: completed
created: 2025-10-19T08:51:48Z
updated: 2025-10-19T15:45:00Z
github: https://github.com/scrooop/ffcs_strategy/issues/3
depends_on: []
parallel: true
conflicts_with: [004]
---

# Task: Enhanced Greeks Collection

## Description
Modify existing `snapshot_greeks()` function to collect both IV (implied volatility) and delta values from dxFeed Greeks streaming. This enables delta-based strike selection for double calendar structures while maintaining backward compatibility.

## Acceptance Criteria
- [x] `snapshot_greeks()` returns dict mapping streamer_symbol → `(iv: float, delta: float)` tuples
- [x] Function signature updated: `async def snapshot_greeks(...) -> Dict[str, Tuple[float, float]]`
- [x] Greeks.delta extracted alongside Greeks.volatility
- [x] Existing ATM scanning logic continues to work (backward compatible)
- [x] Timeout handling preserves partial results
- [x] None/null values handled gracefully

## Technical Details

**Implementation Approach:**
- Modify `snapshot_greeks()` to collect both `Greeks.volatility` and `Greeks.delta`
- Update return type from `Dict[str, float]` to `Dict[str, Tuple[float, float]]`
- Update all call sites to unpack tuples: `iv, delta = greeks_data[symbol]`
- Maintain existing timeout-based snapshot collection logic

**Files Affected:**
- `scripts/ff_tastytrade_scanner.py` - Modify `snapshot_greeks()` function
- Main scanning loop - Update unpacking of Greeks results

**Key Considerations:**
- Backward compatibility: Existing ATM code should require minimal changes
- Delta may be None for some strikes (handle gracefully)
- Both call and put Greeks needed (average IV if both available, use single if only one)

## Dependencies
- [x] dxFeed Greeks streaming provides delta field
- [x] tastytrade SDK DXLinkStreamer functional

## Effort Estimate
- Size: S
- Hours: 1-2 hours
- Parallel: true (can develop alongside Task 001)

## Definition of Done
- [x] Code implemented with type hints
- [x] Function docstring updated with new return type
- [x] Existing ATM scanning continues to work
- [x] Manual testing: Greeks data includes valid delta values
- [x] No crashes when delta is None/missing

## Implementation Summary

**Commit:** bc50b12 (combined with Issue #6)

**Changes:**
- Modified `snapshot_greeks()` function (lines 106-148)
  - Return type: `Dict[str, Tuple[float, float]]`
  - Extracts both `Greeks.volatility` and `Greeks.delta`
  - Graceful None handling for both fields
- Updated call sites (lines 429-435)
  - Unpacks `(iv, delta)` tuples
  - Maintains backward compatibility

**Testing:**
- Syntax check: ✅
- Backward compatibility: ✅ (existing ATM scanning logic unchanged)

**Status:** ✅ COMPLETE - Enables delta-based strike selection for Task #4 (Double Calendar)
