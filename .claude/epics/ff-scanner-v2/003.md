---
name: Double Calendar Strike Selection
status: completed
created: 2025-10-19T08:51:48Z
updated: 2025-10-19T13:30:00Z
completed: 2025-10-19T13:30:00Z
github: [Will be updated when synced to GitHub]
depends_on: [002]
parallel: false
conflicts_with: []
---

# Task: Double Calendar Strike Selection

## Description
Implement algorithm to find strikes closest to ±35Δ (call delta ~0.35, put delta ~-0.35) for double calendar structures. Use enhanced Greeks data (from Task 002) to select optimal strikes within configurable tolerance.

## Acceptance Criteria
- [x] `find_delta_strikes()` function finds call and put strikes near ±35Δ
- [x] Returns `(call_strike_obj, put_strike_obj)` or `(None, None)` if not found
- [x] Supports configurable `--delta-tolerance` (default 0.05, max 0.10)
- [x] Searches strikes within reasonable range (e.g., ±20% from ATM)
- [x] Selects strike with smallest delta error when multiple matches exist
- [x] Logs warning when no strikes within tolerance found

## Technical Details

**Implementation Approach:**
```python
async def find_delta_strikes(
    session: Session,
    expiration_obj,
    target_delta_call: float = 0.35,
    target_delta_put: float = -0.35,
    tolerance: float = 0.05
) -> Tuple[Optional[Strike], Optional[Strike]]:
    """
    Find strikes closest to ±35Δ.
    1. Get all strikes from expiration_obj
    2. Request Greeks for strikes in reasonable range
    3. Filter by delta within tolerance
    4. Return strike with smallest delta error
    """
```

**Files Affected:**
- `scripts/ff_tastytrade_scanner.py` - Add `find_delta_strikes()` function
- CLI argument parser - Add `--delta-tolerance` flag

**Key Considerations:**
- Limit Greeks requests (don't fetch all strikes, just ±20% from ATM)
- Handle case where no strikes within tolerance (log warning, return None)
- Call strikes should have positive delta (~0.35), puts negative (~-0.35)
- Use existing ATM strike as center reference for search range

## Dependencies
- [ ] Task 002 completed (enhanced Greeks with delta)
- [ ] `pick_atm_strike()` available for center reference

## Effort Estimate
- Size: M
- Hours: 3-4 hours
- Parallel: false (requires Task 002)

## Definition of Done
- [ ] Code implemented with proper error handling
- [ ] Function docstring with type hints
- [ ] `--delta-tolerance` CLI flag functional
- [ ] Manual testing: SPY returns strikes near ±35Δ
- [ ] Warning logged when tolerance exceeded
- [ ] Graceful degradation (returns None instead of crashing)
