---
name: X-earn IV Integration
status: open
created: 2025-10-19T08:51:48Z
updated: 2025-10-19T08:51:48Z
github: [Will be updated when synced to GitHub]
depends_on: []
parallel: true
conflicts_with: []
---

# Task: X-earn IV Integration

## Description
Attempt to extract X-earn IV (earnings-removed implied volatility) from tastytrade Market Metrics API for more accurate Forward Factor calculations. Implement graceful fallback to dxFeed Greeks IV if X-earn data unavailable.

## Acceptance Criteria
- [ ] `extract_xearn_iv()` function extracts X-earn IV from MarketMetricInfo
- [ ] Function tries to get IV from `option_expiration_implied_volatilities` field
- [ ] Falls back to Greeks IV if X-earn IV unavailable
- [ ] CLI flags implemented: `--use-xearn-iv` (default), `--force-greeks-iv`
- [ ] `iv_source` tracking added to results (values: "xearn" or "greeks")
- [ ] Warning logged when X-earn IV unavailable

## Technical Details

**Implementation Approach:**
```python
def extract_xearn_iv(
    metrics: Dict[str, MarketMetricInfo],
    symbol: str,
    expiration_date: date
) -> Optional[float]:
    """
    Try to extract X-earn IV from MarketMetricInfo.option_expiration_implied_volatilities.
    Returns None if unavailable.
    """
```

**Decision Point:** End of Week 1
- Test with 5-10 symbols to validate X-earn IV availability
- If unavailable for all symbols → disable feature, defer to v2.1
- If available → full integration and CSV tracking

**Files Affected:**
- `scripts/ff_tastytrade_scanner.py` - Add `extract_xearn_iv()` function
- Main scanning loop - Call before `snapshot_greeks()`
- CLI argument parser - Add X-earn IV flags

**Key Considerations:**
- X-earn IV availability uncertain (40% risk per PRD)
- Must maintain backward compatibility (Greeks IV is default fallback)
- Track source in CSV for post-hoc analysis
- If feature doesn't work, rely on earnings filtering (Task 001) instead

## Dependencies
- [ ] Task 001 recommended (market metrics fetching) but not required
- [ ] tastytrade SDK market metrics API access

## Effort Estimate
- Size: M
- Hours: 2-3 hours
- Parallel: true (can develop alongside Tasks 001-004)

## Definition of Done
- [ ] Code implemented with fallback logic
- [ ] Function docstring with type hints
- [ ] CLI flags functional
- [ ] Manual testing: Validate X-earn IV data quality on 10 symbols
- [ ] Decision made: ship feature or defer to v2.1
- [ ] Warning messages logged appropriately
- [ ] iv_source tracked for each result
