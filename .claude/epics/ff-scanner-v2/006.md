---
name: Enhanced CSV Output
status: open
created: 2025-10-19T08:51:48Z
updated: 2025-10-19T08:51:48Z
github: [Will be updated when synced to GitHub]
depends_on: [001, 002, 004, 005]
parallel: false
conflicts_with: []
---

# Task: Enhanced CSV Output

## Description
Expand CSV output schema to 25 columns including all new features: structure type, double calendar strikes/deltas, earnings data, liquidity metrics, and IV source tracking. Sort results by combined FF descending.

## Acceptance Criteria
- [ ] CSV schema includes all 25 columns (see Technical Details)
- [ ] `timestamp` uses ISO 8601 format (UTC): `YYYY-MM-DDTHH:MM:SSZ`
- [ ] Results sorted by `combined_ff` descending (highest FF first)
- [ ] Structure-specific columns properly null for non-applicable rows
- [ ] Backward compatible: CSV is superset of v1.0 (add columns, don't remove)
- [ ] Column headers are self-documenting (no cryptic abbreviations)

## Technical Details

**Full CSV Schema (25 columns):**
```csv
timestamp,symbol,structure,front_dte,back_dte,front_expiry,back_expiry,spot_price,
atm_strike,call_strike,put_strike,call_delta,put_delta,
front_iv,back_iv,fwd_iv,ff,call_ff,put_ff,combined_ff,
earnings_date,earnings_conflict,liquidity_rating,liquidity_value,
iv_source_front,iv_source_back
```

**Column Handling Rules:**
- ATM calendars: `atm_strike`, `ff` populated; `call_strike`, `put_strike`, `call_ff`, `put_ff` = null
- Double calendars: `call_strike`, `put_strike`, `call_delta`, `put_delta`, `call_ff`, `put_ff`, `combined_ff` populated; `atm_strike` = null
- `combined_ff` = `ff` for ATM, arithmetic mean for double

**Sorting:**
- Primary: `combined_ff` descending
- Secondary: `symbol` ascending (tie-breaker)

**Files Affected:**
- `scripts/ff_tastytrade_scanner.py` - Modify CSV writing logic
- Result data structure - Expand to hold all fields

**Key Considerations:**
- Use `datetime.utcnow().isoformat() + 'Z'` for timestamp
- Handle null/None values as empty strings in CSV
- Preserve backward compatibility (v1.0 CSV consumers should still work)

## Dependencies
- [ ] Task 001 completed (earnings/liquidity data)
- [ ] Task 002 completed (delta values)
- [ ] Task 004 completed (double calendar structure)
- [ ] Task 005 completed (iv_source tracking)

## Effort Estimate
- Size: S
- Hours: 2 hours
- Parallel: false (requires multiple dependencies)

## Definition of Done
- [ ] Code implemented with all 25 columns
- [ ] CSV output validated against schema
- [ ] Manual testing: Output includes all expected columns
- [ ] Sorting works correctly (highest FF first)
- [ ] Null handling correct for structure-specific fields
- [ ] Timestamp format correct (ISO 8601 UTC)
