---
name: Error Handling & Edge Cases
status: open
created: 2025-10-19T08:51:48Z
updated: 2025-10-19T08:51:48Z
last_sync: 2025-10-19T18:19:57Zgithub: [Will be updated when synced to GitHub]
depends_on: [2, 3, 4, 5, 6, 7]
parallel: true
conflicts_with: []
---

# Task: Error Handling & Edge Cases

## Description
Implement robust error handling for partial data scenarios, API failures, and edge cases. Ensure scanner never crashes mid-scan and provides graceful degradation when data is missing or incomplete.

## Acceptance Criteria
- [ ] Handle missing earnings date (log warning, proceed without filtering)
- [ ] Handle missing liquidity rating (log warning, proceed without filtering)
- [ ] Handle Greeks timeout (skip symbol, continue scan)
- [ ] Handle no strikes within delta tolerance (log warning, skip double calendar for that symbol)
- [ ] Handle empty option chain (skip symbol, continue)
- [ ] Handle API failures (log error, skip symbol, continue)
- [ ] Per-symbol error recovery (never crash entire scan)
- [ ] All None/null values validated before use

## Technical Details

**Error Handling Patterns:**

**Pattern 1: Missing Market Metrics Data**
```python
def check_earnings_conflict(symbol: str, metrics: Dict, back_expiry: date, today: date) -> Tuple[bool, Optional[str]]:
    """Returns (passes, reason)."""
    if symbol not in metrics:
        logger.warning(f"{symbol}: Market metrics unavailable, skipping earnings check")
        return (True, None)  # Pass through (can't check, so don't filter)

    earnings_date = metrics[symbol].earnings_date
    if earnings_date is None:
        logger.warning(f"{symbol}: Earnings date unavailable, skipping earnings check")
        return (True, None)  # Pass through

    # ... rest of logic
```

**Pattern 2: Greeks Timeout**
```python
try:
    greeks_data = await snapshot_greeks(session, symbols, timeout=3.0)
except TimeoutError:
    logger.warning(f"{symbol}: Greeks snapshot timed out, skipping")
    continue  # Skip this symbol, continue with next
except Exception as e:
    logger.error(f"{symbol}: Greeks error: {e}, skipping")
    continue
```

**Pattern 3: Delta Strike Selection Failure**
```python
call_strike, put_strike = await find_delta_strikes(...)
if call_strike is None or put_strike is None:
    logger.warning(f"{symbol}: No strikes within {tolerance}Î” tolerance, skipping double calendar")
    # Fall back to ATM-only if --structure=both, or skip if --structure=double
```

**Pattern 4: API Failures**
```python
try:
    metrics = await fetch_market_metrics(session, symbols)
except Exception as e:
    logger.error(f"Market metrics API failed: {e}")
    metrics = {}  # Empty dict, proceed without filtering
```

**Files Affected:**
- `scripts/ff_tastytrade_scanner.py` - Add error handling to all functions
- Main scanning loop - Wrap symbol iteration in try/except

**Key Considerations:**
- Fail gracefully: partial results are acceptable
- Log warnings/errors clearly (help debugging)
- Never crash mid-scan (per-symbol error recovery)
- Validate all API responses for None/null before use

## Dependencies
- [ ] Tasks 001-006 completed (all core features)
- [ ] Can run in parallel with Tasks 007-009

## Effort Estimate
- Size: S
- Hours: 2 hours
- Parallel: true (can develop alongside docs/CLI)

## Definition of Done
- [ ] Code reviewed for None/null handling
- [ ] Try/except blocks added around all API calls
- [ ] Per-symbol error recovery implemented
- [ ] Warning/error messages clear and helpful
- [ ] Manual testing: Introduce failures, verify graceful degradation
- [ ] No crashes when data missing (verified in integration tests)
