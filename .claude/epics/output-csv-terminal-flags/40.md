---
name: Add File Logging Support (--log-file)
status: open
created: 2025-10-20T17:48:36Z
updated: 2025-10-20T18:23:15Z
github: https://github.com/scrooop/ffcs_strategy/issues/40
depends_on: [38]
parallel: false
conflicts_with: [38, 39]
---

# Task: Add File Logging Support (--log-file)

## Description

Add `--log-file <path>` CLI flag to write all logs to file with timestamps. File receives ALL log levels (DEBUG and above), while terminal receives filtered logs based on output mode. Enables "tee" functionality for archiving scan results.

**Priority:** MEDIUM (Phase 4 - Terminal Output & Logging)

**Depends On:** Task #38 must be complete (logging system established)

## Acceptance Criteria

- [ ] `--log-file <path>` flag added to argparse
- [ ] FileHandler added to scanner logger when flag provided
- [ ] File receives ALL log levels (DEBUG and above)
- [ ] Terminal still receives filtered logs (based on mode: quiet/normal/verbose/debug)
- [ ] File output includes timestamps and logger names
- [ ] File created/truncated on scan start (fresh log each run)
- [ ] Clear error if file path is invalid or unwritable

## Technical Details

### Files to Modify
- `scripts/ff_tastytrade_scanner.py`:
  - Add argparse flag (around line 1750-1800)
  - Update `setup_logging()` to add FileHandler when log_file provided (modified in Task #38)

### Implementation Approach

**1. Add CLI Flag:**
```python
parser.add_argument(
    '--log-file',
    type=str,
    metavar='PATH',
    help='Write all logs to file with timestamps (enables "tee" functionality)'
)
```

**2. Update setup_logging() Signature:**
```python
def setup_logging(mode: str, log_file: Optional[str] = None) -> logging.Logger:
    """
    Configure hierarchical logging system.

    Args:
        mode: "quiet", "normal", "verbose", or "debug"
        log_file: Optional file path for logging output

    Returns:
        Root scanner logger
    """
    # ... existing console handler setup ...

    # Add file handler if log_file provided
    if log_file:
        try:
            fh = logging.FileHandler(log_file, mode='w')  # Truncate on start
            fh.setLevel(logging.DEBUG)  # File gets ALL levels
            fh.setFormatter(logging.Formatter(
                '%(asctime)s - %(name)s - %(levelname)s - %(message)s'
            ))
            scanner_logger.addHandler(fh)
        except (IOError, PermissionError) as e:
            # Log to console if file can't be created
            scanner_logger.error(f"Failed to create log file {log_file}: {e}")

    return scanner_logger
```

**3. Update main() to Pass log_file:**
```python
# In main() after determining mode (Task #39)
logger = setup_logging(mode, log_file=args.log_file)
```

### Key Considerations
- File handler uses standard format (timestamps + logger name)
- File always gets DEBUG level (regardless of terminal mode)
- Truncate file on start (mode='w') for fresh log each scan
- Handle file creation errors gracefully (log to console, continue scan)
- File path can be absolute or relative

### Output Examples

**Terminal Output (--log-file scan.log, normal mode):**
```
[SPY   ] PASS: FF=0.285 (30-60 DTE, strike=450.0, double)
[TSLA  ] PASS: FF=0.235 (60-90 DTE, strike=880.0, atm-call)
Scan complete: 150 scanned, 23 passed, 127 filtered (82s)
```

**File Output (scan.log, ALL levels):**
```
2025-10-20 17:48:36,123 - scanner - INFO - Starting scan: 150 symbols, 3 DTE pairs
2025-10-20 17:48:36,456 - scanner.earnings - DEBUG - Cache hit: SPY earnings (2025-11-15)
2025-10-20 17:48:37,789 - scanner.greeks - DEBUG - Greeks IV fetched: SPY 30DTE call=0.25 put=0.27
2025-10-20 17:48:38,012 - scanner - INFO - SPY: PASS (FF=0.285, strike=450.0)
2025-10-20 17:48:38,234 - scanner.quality - WARNING - QQQ: Earnings conflict (2025-11-15)
...
2025-10-20 17:50:58,567 - scanner - INFO - Scan complete: 150 scanned, 23 passed, 127 filtered (82s)
```

## Dependencies

**Internal:**
- [x] Task #38 (Hierarchical Logging System) must be complete
- [ ] Conflicts with Task #38 (same code for setup_logging function)
- [ ] Conflicts with Task #39 (same code for logger configuration)

## Effort Estimate

- **Size:** XS (Extra Small)
- **Hours:** 2-3 hours
- **Parallel:** false (conflicts with tasks 38, 39)

### Breakdown:
- Add flag & update setup_logging: 1 hour
- Test file output & error handling: 1-2 hours

## Definition of Done

- [ ] `--log-file <path>` flag implemented
- [ ] FileHandler added to scanner logger
- [ ] File receives ALL log levels (verified with DEBUG messages)
- [ ] Terminal still respects output mode (quiet/normal/verbose)
- [ ] File includes timestamps and logger names
- [ ] File created/truncated on scan start
- [ ] Error handling tested (invalid path, no write permission)
- [ ] Tested with various paths (absolute, relative, subdirectories)
