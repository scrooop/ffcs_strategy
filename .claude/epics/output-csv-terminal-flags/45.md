---
name: Integration Testing & Validation
status: open
created: 2025-10-20T17:48:36Z
updated: 2025-10-20T18:23:15Z
github: https://github.com/scrooop/ffcs_strategy/issues/45
depends_on: [36, 37, 38, 39, 40, 41, 42]
parallel: true
conflicts_with: []
---

# Task: Integration Testing & Validation

## Description

Comprehensive integration testing of all implemented features: output modes, file logging, CSV schema v3.0, IV source control, and high-volume scanning. Validate all flag combinations and ensure backward-incompatible changes are documented.

**Priority:** LOW (Phase 5 - Documentation & Testing)

**Depends On:** All implementation tasks (36-42) must be complete

## Acceptance Criteria

- [ ] All output modes tested (quiet, normal, verbose, debug)
- [ ] All flag combinations tested (at least 10 combinations)
- [ ] CSV v3.0 schema validated (32 columns, correct data)
- [ ] Migration tested with real v2.2 CSV files
- [ ] High-volume scan tested (1500+ symbols, no crashes)
- [ ] Performance benchmarked (`--iv-ex-earn` vs default)
- [ ] File logging tested (all log levels captured)
- [ ] Regression tests pass (existing functionality still works)

## Technical Details

### Test Categories

**1. Output Mode Testing:**
```bash
# Test quiet mode
python scripts/ff_tastytrade_scanner.py --tickers SPY QQQ --pairs 30-60 --quiet

# Test normal mode (default)
python scripts/ff_tastytrade_scanner.py --tickers SPY QQQ --pairs 30-60

# Test verbose mode
python scripts/ff_tastytrade_scanner.py --tickers SPY QQQ AAPL TSLA --pairs 30-60 --verbose

# Test debug mode
python scripts/ff_tastytrade_scanner.py --tickers SPY --pairs 30-60 --debug
```

**2. Flag Combination Testing:**
```bash
# Combinations to test (at least 10):
1. --quiet + --csv-out scan.csv
2. --verbose + --log-file scan.log
3. --verbose + --csv-out scan.csv
4. --iv-ex-earn + --csv-out scan.csv
5. --iv-ex-earn + --verbose
6. --quiet + --iv-ex-earn + --csv-out scan.csv
7. --verbose + --log-file scan.log + --csv-out scan.csv
8. --debug + --log-file debug.log
9. --allow-earnings + --verbose
10. --structure double + --verbose + --csv-out doubles.csv
```

**3. CSV Schema Validation:**
```python
import pandas as pd

# Read v3.0 CSV
df = pd.read_csv("scan_v3.0.csv")

# Validate column count
assert len(df.columns) == 32, f"Expected 32 columns, got {len(df.columns)}"

# Validate required columns exist
required_cols = ["timestamp", "symbol", "structure", "strike", "delta", "ff", "min_ff"]
for col in required_cols:
    assert col in df.columns, f"Missing required column: {col}"

# Validate removed columns don't exist
removed_cols = ["atm_strike", "atm_delta", "atm_ff"]
for col in removed_cols:
    assert col not in df.columns, f"Removed column still present: {col}"

# Validate ATM row structure
atm_rows = df[df["structure"] == "atm-call"]
assert all(pd.notna(atm_rows["strike"])), "ATM rows missing 'strike' values"
assert all(pd.notna(atm_rows["ff"])), "ATM rows missing 'ff' values"
assert all(pd.isna(atm_rows["put_strike"]) | (atm_rows["put_strike"] == "")), "ATM rows should have empty put_strike"

# Validate double row structure
double_rows = df[df["structure"] == "double"]
assert all(pd.notna(double_rows["strike"])), "Double rows missing 'strike' values"
assert all(pd.notna(double_rows["put_strike"])), "Double rows missing 'put_strike' values"
assert all(pd.notna(double_rows["ff"])), "Double rows missing 'ff' values"
assert all(pd.notna(double_rows["put_ff"])), "Double rows missing 'put_ff' values"

print("âœ… CSV v3.0 schema validation passed")
```

**4. Migration Testing:**
```bash
# Generate v2.2 CSV (if available from backup)
# Compare with v3.0 CSV to ensure data integrity

# Test v2.2 parser breaks gracefully on v3.0 CSV
python test_v2_parser.py scan_v3.0.csv  # Should fail with clear error

# Test v3.0 parser works on v3.0 CSV
python test_v3_parser.py scan_v3.0.csv  # Should pass
```

**5. High-Volume Scanning:**
```bash
# Test with S&P 1500 symbol list (1500+ symbols)
python scripts/ff_tastytrade_scanner.py \
  --tickers @SP1500 \
  --pairs 30-60 \
  --csv-out sp1500_scan.csv \
  --log-file sp1500.log

# Verify:
# - No crashes (exit code 0)
# - skip_stats shows invalid_chain_data count
# - CSV includes skip_reason for filtered symbols
# - Log file contains all symbols
```

**6. Performance Benchmarking:**
```bash
# Benchmark 1: Greeks IV (default)
time python scripts/ff_tastytrade_scanner.py --tickers SPY QQQ AAPL TSLA NVDA META AMZN GOOGL MSFT NFLX --pairs 30-60 --csv-out greeks.csv
# Record runtime: e.g., 45s

# Benchmark 2: Ex-earn IV (--iv-ex-earn)
time python scripts/ff_tastytrade_scanner.py --tickers SPY QQQ AAPL TSLA NVDA META AMZN GOOGL MSFT NFLX --pairs 30-60 --csv-out exearn.csv --iv-ex-earn
# Record runtime: e.g., 32s

# Calculate improvement: (45 - 32) / 45 = 28.9% faster
```

**7. File Logging Validation:**
```bash
# Run scan with file logging
python scripts/ff_tastytrade_scanner.py \
  --tickers SPY QQQ AAPL \
  --pairs 30-60 \
  --verbose \
  --log-file test.log

# Verify log file:
# - Contains timestamps (2025-10-20 HH:MM:SS,mmm)
# - Contains logger names (scanner, scanner.earnings, etc.)
# - Contains ALL log levels (DEBUG, INFO, WARNING, ERROR)
# - Terminal output matches file output (except timestamps)
```

**8. Regression Testing:**
```bash
# Verify existing functionality still works:

# 1. ATM calendar scanning
python scripts/ff_tastytrade_scanner.py --tickers SPY --pairs 30-60 --structure atm-call

# 2. Double calendar scanning
python scripts/ff_tastytrade_scanner.py --tickers SPY --pairs 30-60 --structure double

# 3. Earnings filtering
python scripts/ff_tastytrade_scanner.py --tickers AAPL --pairs 30-90 --show-earnings-conflicts

# 4. Liquidity filtering
python scripts/ff_tastytrade_scanner.py --tickers AAPL --pairs 30-60 --skip-liquidity-check

# 5. Multiple DTE pairs
python scripts/ff_tastytrade_scanner.py --tickers SPY --pairs 30-60 30-90 60-90

# 6. Futures options
python scripts/ff_tastytrade_scanner.py --tickers /ES /NQ --pairs 30-60
```

### Test Checklist

- [ ] Quiet mode suppresses per-symbol output
- [ ] Normal mode shows only passed symbols
- [ ] Verbose mode shows ALL symbols (150+ if applicable)
- [ ] Debug mode shows timestamps and logger names
- [ ] File logging captures all log levels
- [ ] CSV has exactly 32 columns
- [ ] ATM rows populate unified columns correctly
- [ ] Double rows populate all columns correctly
- [ ] Column order matches Task #42 (trading-focused layout)
- [ ] `--iv-ex-earn` flag produces valid FF values
- [ ] `--iv-ex-earn` shows 20-30% performance improvement
- [ ] 1500+ symbol scan completes without crashes
- [ ] Skip stats show invalid_chain_data count
- [ ] All flag combinations work without conflicts
- [ ] Existing functionality not broken (regression tests pass)

### Key Considerations
- Test on production tastytrade API (not sandbox)
- Use real symbol lists (not just SPY/QQQ)
- Measure actual performance improvements
- Verify CSV schema byte-for-byte (column count, names, order)
- Test error cases (invalid log file path, missing symbols, etc.)

## Dependencies

**Internal:**
- [x] Task #36 (`--iv-ex-earn`) must be complete
- [x] Task #37 (Bug Fixes) must be complete
- [x] Task #38 (Logging System) must be complete
- [x] Task #39 (Output Modes) must be complete
- [x] Task #40 (File Logging) must be complete
- [x] Task #41 (CSV Refactor) must be complete
- [x] Task #42 (Column Reordering) must be complete

## Effort Estimate

- **Size:** L (Large)
- **Hours:** 6-8 hours
- **Parallel:** true (can run while documentation is updated)

### Breakdown:
- Output mode testing: 1 hour
- Flag combination testing: 2 hours
- CSV schema validation: 1 hour
- Migration testing: 1 hour
- High-volume scanning: 1-2 hours
- Performance benchmarking: 1 hour
- Regression testing: 1 hour

## Definition of Done

- [ ] All 4 output modes tested (quiet, normal, verbose, debug)
- [ ] At least 10 flag combinations tested successfully
- [ ] CSV v3.0 schema validated (32 columns, correct structure)
- [ ] Migration tested with real v2.2 CSV (if available)
- [ ] 1500+ symbol scan completed without crashes
- [ ] Performance benchmark completed (`--iv-ex-earn` vs default)
- [ ] File logging validated (all log levels captured)
- [ ] Regression tests passed (existing functionality works)
- [ ] Test results documented (summary of findings)
- [ ] No critical bugs found (or all bugs fixed before completion)
